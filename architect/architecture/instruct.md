## 1.指令系统

@info 指令系统是计算机硬件的语言系统，是机器所具有的<mark>全部指令的集合</mark>,反映了计算机所拥有的基本功能。

### 1.1 常见的指令系统
* **复杂指令系统（Complex Instruction Set Computer，CISC）**：增强原有指令的功能，用更为复杂的新指令取代原先由软件子程序完成的功能，实现软件功能的硬化。其特点有：
    1. <mark>指令数量多</mark>，通常有100~250条；
    2. <mark>指令的平均使用频率相差悬殊</mark>，较为常用的比较简单的指令总数仅仅占总指令数的20%，但使用频率却占80%；大部分复杂指令很少被使用；
    3. <mark>支持多种寻址方式</mark>，通常为5~20种；
    4. <mark>变长的指令</mark>。指令的长度不固定，同时也增加了指令译码电路的复杂性；
    5. <mark>指令可直接对主存单元中的数据进行处理</mark>。一些典型的CISC通常都有指令可直接对主存单元中的数据进行处理，其执行速度较慢（主存的速度远不如CPU中寄存器速度快）；
    6. <mark>以微程序控制为主</mark>。CISC的指令系统很复杂，很难用硬布线逻辑（组合逻辑）电路实现控制器，通常采用微程序控制

* **精简指令系统（Reduced Instruction Set Computer， RISC）**：通过减少指令总数和简化指令功能，减低硬件设计复杂度，使指令可以单周期执行，并通过优化编译提高指令的执行速度。其特点有：
    1. <mark>指令数量少</mark>。选取了一些使用频率较高的指令集合和一些常用的指令，大大减少了指令的数量；
    2. <mark>指令的寻址方式较少</mark>
    3. <mark>指令长度固定，</mark>指令格式种类少；
    4. <mark>以硬布线逻辑控制为主</mark>。常采用硬布线逻辑（组合逻辑）来构建控制器；
    5. <mark>单周期指令执行，可采用流水线技术。</mark>由于简化了指令系统，使得大部分指令可以在一个[机器周期](#jqzq)内完成;
    6. <mark>优化的编译器。</mark> 因为指令长度固定、格式少、寻址方式少，编译时不必在具有相似功能的许多指令中进行选择，也不必为寻址方式的选择而费心，这样的设计易于实现优化，从而提升执行效率；
    7. <mark>CPU中的通用寄存器数量较多，</mark>一般不少于32个。便于和寄存器交互，其速度要比和主存交互快上很多。

## 2.指令
我们的程序代码首先要经过**编译**（Compile），编译成**汇编代码**（ASM），汇编代码在经过**汇编器**（Assembler）翻译成**机器码**（Machine Code）。**机器码就是一条一条的计算机指令**。宏观上可以分为两部分，即**操作码**和**数据地址**。操作码用来标识一条指令的功能，数据地址则是该指令要操作的对象。

|操作码|数据地址|
|-|-|

~~根据指令数据地址的数目不同又可分为：零地址指令、一地址指令、二地址指令、三地址指令和四地址指令~~

### 2.1 指令的执行过程

<img src="/assets/imgs/architect/architecture/instruct/指令的执行过程.jpg">

* PC：指令（程序）计数器，总是指向下一条要执行的指令的地址；
* IR：指令寄存器，存放即将要执行的指令；
* ID：指令译码器，解读指令要执行的何种操作；
* MAR：地址寄存器，存放指令在内存中的地址，它的存在一定程度上解决了直接到内存查找速度上的不匹配；
* MDR：数据寄存器，存放从内存取出的数据/指令
* PSW：状态寄存器，状态切换时，用于保存当前程序的执行状态
* ALU：算术逻辑单元，进行算术、逻辑运算
* ACC：累加寄存器，存放运算前的操作数，或运算结果的寄存器

**下面以执行：ADD R0,[8]为例，说明各个组件间的工作顺序**
指令功能：将通用寄存器R0的内容 **加上** 地址为8的存储单元所存储的内容 **赋值给** 通用寄存器R0

1. 取指：PC ---> MAR ---> M(存储器) --->MDR ---> IR，（PC）+ 1 ---> PC

步骤说明：PC知道下一条要执行的指令的地址，所以需要把PC中存储的值给MAR，然后再到存储器，在存储器中查询到的指令发送给MDR，最后将指令发送给IR，同时PC值加一（取指后即刻+1，后续步骤可使用流水线）

2. 分析：OP(IR) ---> ID ---> CU

步骤说明：IR将操作码部分通过ID译码发现是加法指令，之后交给CU 

3. 执行：Ad(IR) ---> MAR ---> M ---> MDR ---> Y(ALU)，CU ---> R0 ---> X(ALU), X(ALU) + Y(ALU) ---> Z(ALU), Z(ALU) -> R0

步骤说明：IR将数据码部分交给MAR，重复1步骤，将取出的数据值存放到ALU的一个输入端Y寄存器；控制器将R0中的值传送到ALU的另一个输入端X寄存器，然后便可开始加法运算，将结果从ALU的输出端Z寄存器会写到R0通用寄存器

### 2.2 指令流水线






## 附录
* **主频**: 计算机内部时钟的频率，通常以MHz或者GHz为单位，数值越高，CPU的运算速度越快。
* **时钟周期**: 计算机中最小的时间单位，等于CPU主频的倒数。
* **<a id="jqzq">机器周期</a>**: 又称CPU周期。为了方便，常把一条指令的执行过程划分为若干个阶段（如取值、译码、执行等），每个阶段完成一个基本操作。完成一个基本操作的时间成为机器周期。一般情况下，一个机器周期由若干个时钟周期组成。
* **指令周期**: 取出并执行一条指令的时间。
