## 进程管理

### 1.进程基础
@info 进程是操作系统进行资源分配和调度的基本单位，通常由程序、数据集合以及<mark>进程控制块(PCB)</mark>组成。PCB是进程存在的唯一标识，可使用<mark>线性、链接、索引</mark>三种方式来进行管理。

#### 1.1 进程的状态(三态模型)

1. **运行态**：表示该进程正在处理机上运行；
2. **就绪态**：表示该进程获得了除了处理机以外的一切运行资源，等待被调度执行；
3. **阻塞态**：表示该进程正在等待/竞争运行需要的资源。

**三态间的转换关系如下：**

<img src="/assets/imgs/architect/os/progress/进程-三态模型.jpg">

#### 1.2 PCB的管理方式

|实现方式|描述|
|-|-|
|线性方式|把所有的PCB组织在一张线性表中，每次查找需扫描全表|
|链接方式|把具有相同状态的PCB通过链接字（可理解为尾部指针，存放的是下一个具有相同状态的PCB的地址）链接成队列|
|索引方式|每个状态的PCB都整理成多张状态索引表，每张状态索引表内存储相同状态的PCB的地址|

#### 1.3 前趋图

@info 前趋图是一个有向无循环图，由节点和有向边组成，节点代表各程序段的操作，有向边代表两个程序段之间的执行顺序。

找出下面前趋图中的前趋关系：

<img src="/assets/imgs/architect/os/progress/前趋图.png">

根据前趋关系定义，上图共有以下前趋关系：

(P1,P2),(P2,P3),(P1,P3),(P2,P5),(P3,P4),(P3,P5),(P4,P6),(P5,P6),(P5,P7),(P5,P8),(p6,P8),(P7,P8)

### 2.进程的通信

#### 2.1 进程互斥

系统中的多个进程，在执行过程中，因为一些<mark>临界资源</mark>(每次直允许被一个进程占用的资源)被某个进程占用，其他进程只能在该进程释放资源之后才能去访问该资源，这就是进程互斥，其本质就是因临界资源而形成的一种<mark>竞争关系</mark>。

**互斥机制准则**：
* 空闲让进：临界区空闲时，允许一个请求进入；
* 忙则等待：临界区内已有进程，其他试图进入的必须等待；
* 有限等待：对请求临界资源的进程，应保证在有限时间内进入临界区；
* 让权等待：当进程不能进去临界区，应立即释放处理器，防止因等待长时间占用处理器

#### 2.2 进程同步

进程同步是指多个进程之间存在<mark>时序关系</mark>，需要协作来完成一个任务。比如：P1会将自己执行的结果放入缓冲区内，P2会将缓冲区内的数据包装打印。缓冲区内为空时，P2会被阻塞，P1会被唤醒；缓冲区内有数据时P1被阻塞，P2被唤醒，如此P1和P2之间就有了协作关系。

#### 2.3 PV操作

@info PV操作是操作系统中的一种同步机制，用于实现在多线程并发中对临界区的管理。

**关于PV操作的基本概念：**
* 信号量：用来记录资源可用数量，常用S表示。S >= 0表示可申请使用该资源，S < 0，其绝对值表示因申请该资源而阻塞的进程数
* P操作：申请资源，将该资源代表的S值 -1
* V操作：释放资源，将该资源代表的S值 +1

**标注信号量：**
在前趋图中标注信号量，遵循<mark>从左到右，从小大大</mark>的原则，信号量标注在两个程序段操作之间的有向线上，如下图所示：

<img src="/assets/imgs/architect/os/progress/进程互斥-信号量.png">

在执行过程中，所发生的PV操作如下：
1. P1执行完：V(S1)、V(S2)
2. P2执行前：P(S1)、P(S3)，P2执行完：V(S4)
3. P3执行前：P(S2)，P3执行完：V(S3)、V(S5)
4. P4执行前：P(S4)、P(S5)

**P1、P4分别是开始和结束节点，开始节点无P操作，结束节点无V操作**

[例题1：]{color:red}<p>
假设系统中有 **N** 个进程共享 **3** 台打印机，那么：<br/>
1. 信号量S的取值范围是：()
2. S = -3, 进程中有（）个进程在等待使用打印机

[解：]{color:red}
1. N个进程共享3台打印机，在没有任何进程申请打印资源时，S可取到最大值3；当所有进程都申请打印资源是，S取得最小值 -N + 3，因此，S的置区范围是：[3, 3-N]
2. S = -3, 根据信号量定义，则有|S|个进程在等待打印资源，即为：3
