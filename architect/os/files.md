## 文件管理

### 1. 文件结构

@info 文件的结构是指文件的组织形式，通常文件的组织形式有两种：<mark>逻辑结构</mark> 和 <mark>物理结构</mark> 

* **逻辑结构**：用户看到的文件组织形式
* **物理结构**：文件在文件存储器上的存放形式

#### 1.1 物理结构中的文件索引

文件索引记录了文件存放物理盘块的具体地址，其又可分为**直接索引、一级间接索引、二级间接索引和三级间接索引、**

* **直接索引**：文件索引项直接存放文件所在物理盘块的真实地址；
* **一级间接索引**：文件索引项存放另一个索引节点，这个索引节点每一项存放的是文件所在物理盘块的真实地址；
* **二、三级间接索引**：按照一级间接索引的思路套娃

[例题1：]{color:red}<p>
某文件系统采用文件索引法存储文件。若索引节点有8个地址项(iaddr[0] ~ iaddr[7])，每个地址项的大小为4字节；<br/>其中，iaddr[0] ~ iaddr[5]为直接地址索引；<br/>iaddr[6]为一级间接索引；<br/>iaddr[7]为二级间接索引。若磁盘索引块和数据块均为4KB，那么：<br/>该文件系统可表示的单个文件的最大长度是( ? )KB<br/>若要访问a文件的逻辑块号分别为6、520、1030，则应分别采用( ? )

[解：]{color:red}
1.  iaddr[0] ~ iaddr[5]共6个地址项，每个都是直接索引，故可以找到6个大小为4KB的物理块；<br/>iaddr[6]为一级间接索引，则一个地址项可以找到一个大小为4KB的索引节点，又知：每个地址项的大小为4字节，则4KB的索引节点共有 4KB / 4B = 1024个地址项；<br/>同理可知二级间接索引；<br/>综上所述：可表示的单个文件的最大长度是：6 * 4KB + 1024 * 4KB + 1024 * 1024 * 4KB = 4198424

2. 由第一问可知：<br/>直接索引块号范围：[0, 5]<br/>一级间接索引范围：[6, 1029]<br/>二级间接索引范围：[1030, 1049605]<br/>故，应分别采用一级间接索引、一级间接索引、二级间接索引。

### 2. 文件存储空间管理

在给文件分配空间时，是以磁盘的盘块位基本单位分配的，那么必须要记录磁盘的盘块是否可用于分配（即盘块是否空闲），以及提供一些管理和回收的手段，文件存储空间管理则是用来完成上述功能的。

#### 2.1 位示图
用二进制的一位来表示磁盘中的一个盘块的使用情况，0表示空闲，1表示使用（或者1表示空闲，0表示使用）。
磁盘上的所有盘块都有一个二进制位与之对应（位示图的位数和磁盘的盘块数相等，一一对应），这样由所有盘块所对应的位构成的集合称为位示图。

[例题2：]{color:red}<p>

<img src="/assets/imgs/architect/os/files/位示图题目.png">

[解：]{color:red}
1. 一列能表示64个物理块，4列能表示256个物理块。因为物理块号从0开始标号，所以256号应在第5列；由因为列号也是从0开始编号，所以物理块号256在位示图中编号为4的字中描述。
2. 0表示空闲，1表示使用，字的排序时从右向左，故系统应将该字的0号位置1。

因此，答案选：B、A