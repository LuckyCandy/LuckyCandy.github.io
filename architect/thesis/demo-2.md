## 层次式架构范文

**标记部分为主要论点**

**摘要：**

<p style="text-align:right;color:red">共300字</p>

2020年3月，我加入了某教育综合管理系统项目团队，担任系统架构设计师一职。在此项目中，我主要负责架构评估、架构设计以及逻辑架构的代码实现。项目主要分为学员管理、员工管理和辅助决策三大功能模块，覆盖了学员录入、合同创建与付费、学管分配、预约上课等业务流程。同时，系统还实现了员工绩效评级、任务管理以及汇总报表数据功能，并通过分析操作、访问日志生成用户画像，为公司产品定价、活动宣传和服务跟踪提供了数据支持。项目自2020年3月启动，经过14个月的努力，于2021年5月正式交付并投入运行，赢得了客户的一致好评。<mark>本文将以此项目为背景，探讨层次式架构的特性、优势、具体应用场景</mark>。

---

**背景：**

<p style="text-align:right;color:red">共444字</p>

随着教育行业的繁荣发展和公司规模的不断扩大，日益增长的大量数据使得业务流程的维护和管理变得愈发困难。首先，传统笨重、繁琐的文档化管理方式已无法满足不断壮大的业务数据需求；其次，在疫情期间，员工和学员无法线下出勤，而第三方线上授课软件在教学质量和服务跟踪方面存在不容忽视的缺陷。为了提高工作效率，规范业务流程，降低运营成本并提升客户满意度，该企业决定推进信息化建设。因此，某教育综合管理系统项目应运而生。我司成功中标该项目，我担任了系统架构设计师职位，负责架构评估和设计，并与其他团队成员紧密协作，以确保项目的顺利进行和高质量交付。项目主要包含三大功能模块：一、学员管理，涵盖学员档案建立、周期性计费合同录入、学管分配与跟踪、预约上课、课后联系与评价等子功能；二、员工管理，包括员工信息管理、考勤打卡、绩效评定以及任务管理等功能；三、辅助决策，由审批流管理和系统用户画像查询组成，便于管理层审批员工请求，参考用户画像制定合适的教学策略。同时，根据学员的评价反馈，提供更加有效的教学方案。

---

**过渡段：**

<p style="text-align:right;color:red">共330字</p>

经与产品经理、客户代表多次开会商讨，确定下了功能需求以及客户比较注重的质量属性（高可用性、灵活拓展），最终我们决定选用层次式架构。层次式架构又称为分层架构，是通过将系统划分为多个层次来实现功能模块和组件的解耦，提高系统的可维护性、可扩展性和可重用性。在层次式架构中，每一层都负责一组特定的功能，上层依赖于下层提供的服务，而下层不直接依赖于上层。通常情况下，较低的层次更加接近底层的资源和数据，而较高的层次则更加接近用户界面和业务逻辑。这种分层的设计使得系统更易于理解、维护和扩展。这种架构方式有助于简化系统设计，降低系统各部分之间的耦合度。在此项目中我们从上到下将系统分为：表示层、负载均衡层、业务逻辑层、业务中台、数据访问层、数据层。下面详细描写每层的具体实现。

---

**正文：**

<p style="text-align:right;color:red">共330字</p>

表示层主要负责用户界面和交互，我们使用了前后端分离的设计理念，它可以让前端专注于展示和交互的细节处理，后端则注重数据处理和业务功能的实现。前后端之间事先约定好数据结构和接口的定义，使用Yapi工具，模拟真实API返回，如此便可做到并行开发，大幅度提高开发效率。在前端技术栈中，Vue全家桶（包括Vue、Vue-Router、ElementUI和Vuex）是一套非常流行的框架和库的组合。Vue是一个轻量级且易于上手的JavaScript框架，用于构建用户界面。Vue-Router负责管理页面路由，实现单页面应用（SPA）。同时ElementUI提供了丰富的UI组件，避免了重复造轮子，可快速快速搭建美观、样式统一的用户交互界面。Vuex则是一个状态管理库，用于在组件间共享状态数据。为了减轻服务端带宽，打包后的资源会被统一发布到CDN网络，在上线前提前进行预热，尽可能缩短页面加载时间，提高用户的使用体验。

负载均衡层使用Nginx做反向代理服务器，实现多个服务器之间的负载分配，确保系统具有高可用性和扩展性。区别与传统的负载均衡策略，我们编译安装Nginx增加了GEOIP2模块支持，可通过主域名解析用户的IP地址，获取用户的地址位置信息，根据不同的城市地域配置，转发用户请求。当然，用户可以手动选择城市，使用二级域名访问请求则不会被二次转发。这么做的目的主要有两点：（1）实现业务数据在城市维度的隔离，每个城市数据自治（每个节点独享数据存储）；（2）自动转发到距离用户最近的服务器上，减少了网络延迟，响应速度会有明显提升。

业务逻辑层负责处理各种业务逻辑和业务流程。我们采用面向对象编程（OOP）思想，将数据和行为封装为对象，通过对象之间的互动来实现业务逻辑，从而提高代码的复用性、灵活性和可维护性。实现过程需要识别对象、梳理关系并确定合适的设计模式。以课程实体为例，属性包括：课程名、科目、授课教师、售价、课时等。不同课程名可能有相同科目，适用年级、授课教师不同。这种情况下，使用抽象工厂设计模式来组织对象比较合适。再比如数据报表实现，采用阿里巴巴开源项目Canal工具监控数据库的binlog日志，并将其过滤封装成消息投递到消息队列中等待消费者消费。消费者根据数据库字段变化定义特定业务指标的函数计算，计算完成后存入日宽表，根据业务逻辑决定是否触发更高维度（周、月等）的计算。由于Canal是Java开发的，我们的项目基于PHP，为降低技术栈和维护成本，采用异步消息队列，由PHP函数完成消息消费和指标计算。对于决策管理部分，我们采用事件驱动风格实现：（1）在每个节点部署日志采集器Filebeat；（2）将数据发送至Logstash进行简单过滤和数据转化；（3）将清洗转换后的数据保存至ElasticSearch；（4）使用Kibana的Dashboard、Visualize等功能提取用户行为、偏好、特征等信息。

业务中台集成了多个关键组件，以支持各种业务场景。支付中心负责处理与支付相关的业务逻辑，并提供统一的支付接口；用户中心处理与用户相关的业务逻辑，并与其他组件协同工作以实现统一体验；文件中心负责管理系统中的各种文件资源，提供文件上传、下载、存储和转换等功能。为了实现高性能的数据访问，我们选择了 Eloquent 作为 ORM（对象关系映射）库。Eloquent 内部封装了对缓存的支持，允许开发者在查询过程中以链式调用的方式轻松操作缓存。此外，我们采用了 MySQL 作为数据存储和管理的解决方案，以保证数据层的稳定性和可靠性。

---

**结尾：**

在本文中，我们讨论了层次式架构的重要性和优势。通过将不同的功能模块进行分层解耦，我们可以显著提高系统的可维护性、可扩展性和灵活性。为了解决相邻层之间的高度依赖问题，我们对低层（例如数据访问层和业务中台）进行了高度抽象，实现了从依赖低层实现到依赖确定抽象的过渡。这种方法可以大大降低低层变动对高层的影响。通过对该项目的研究，我对分层架构有了更加清晰的认识：经典的三层或四层架构仅为我们提供了一种架构设计思路。在实际应用中，我们不应过分追求固定的层数或层次名称，而应根据具体业务场景确定分层。同时，为了避免过多分层带来的额外开支（如性能降低和系统复杂性增加），我们需要在分层设计中寻求平衡。

在项目的实施过程中也遇到了许多问题：（1）每个节点部署相同的业务逻辑层代码；（2）使用redis充当消息中间件造成消息丢失，消息顺序混乱问题。问题2实在内部测试中被发现，相对比较隐蔽。最终选择更换更成熟的消息中间件RabbitMQ来取代。问题1由于项目时间紧张，意识到这个问题的时间也相对较晚，只能在将来的系统演化时解决。主要思路是：业务代码根据功能边界划分为单个的服务，数据的分离下沉到数据访问层实现。




