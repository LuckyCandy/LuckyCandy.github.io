## NoSQL数据库

关系型数据库对并发量较大的网站来说，磁盘I/O性能会是很大的瓶颈；在一张海量数据的表中进行查询操作，其效率也是非常低的；用户量与访问量与日俱增，通过增加硬件配置来横向拓展也比较麻烦：
* 复杂性：集群配置、部署、管理等
* 扩容需要对整个数据重新分区
* 主备切换造成较大的延迟等

对于24小时不间断提供服务的应用来说，一次扩容还是相当有挑战的。
针对上面的问题，NoSQL出现了。

NoSQL（Not Only SQL），并不是摒弃SQL，而是不局限于SQL，提供更灵活的可扩展性。

### 1. CAP理论

CAP理论对应了<mark>分布式系统</mark>的三个指标：

* **一致性(C,Consistency)：**客户端的每次读操作，要么读到的是最新的数据，要么读取失败，所有节点在同一时间的数据完全一致。

* **可用性(A,Availability)：**是指服务应一直可用，且响应时间正常。

* **分区容错性(P,Partition tolerance)：**是指系统中某节点或者网络分区遇到故障时，仍有对外提供一致性和可用性的服务的能力。

而CAP理论说的就是：一个分布式系统，不可能同时做到这三点。如下图：

<img src="/assets/imgs/architect/database/CAP.png">

所以，我们要根据自己的业务要求，选择合适的两项：

|组合|解释|缺点|
|-|-|-|
|CA|优先保证一致性和可用性，放弃分区容错性|失去分布式扩展灵活性|
|CP|优先保证一致性和分区容错性|出错时会返回错误，影响用户体验|
|AP|优先保证可用性和分区容错性|数据在某个时间内会不一致|

### 2.BASE理论

BASE理论可以看作CAP理论的折衷理论，因为CAP的要求无法全部实现，仅选择CA、CP或者AP并非最佳的实施方案。BASE理论则主张分布式系统应<mark>基本可用、数据可以短时间不同步但最终要同步</mark>

* **基本可用(BasicallyAvailable)：**是指在分布式系统出现不可预知的故障时，允许损失部分可用性，允许分区失败的情形出现；

* **软状态(Soft state)：**状态可以有一段时间不同步；

* **最终一致性(Eventually consistency)：**系统中的所有数据副本，在经过一段时间同步后，最终要达到一个一致的状态。

### 3.分类

* **键值数据库：**也称为K-V数据库，键可以是一个字符串，值可以是任意类型的数据。这种数据库适合设计频繁读写、数据模型比较简单的应用，相关产品有：<mark>Redis、Memcached、</mark>、Riak、SimpleDB、Scalaris等

* **列族数据库：**与行式存储不同，列族数据库数据按列存储，每一列单独存放。这样的结构设计带来的好处就是查找速度快，可扩展性强，缺点就是功能较少且产品大都不支持强事务。主流产品有：BigTable、HBase、HadoopDB等

* **文档数据库：**也由K-V键值对组成，不同的是值是版本化的文档，可以是JSON对象、数组或者是其他文档；可以根据键或者内容来构建索引，并发性能较好，适用于存储、索引并管理面向文档的数据或者类似的半结构化数据；主流的产品：MongoDB、CouchDB、Terrastore等

* **图形数据库：**是面向图的数据库，以“图”这种数据结构作为逻辑结构存储和查询数据。比较适合用于处理具有高度相互关联的数据，支持的数据规模较小；主流产品有：Neo4j、OrientDB、GraphDB

### 4.SQL 与 NoSQL

SQL 与 NoSQL 的对比如下表所示：

|对比点|SQL|NoSQL|
|-|-|-|
|数据类型|结构化|非结构化|
|数据一致性|强一致性|弱一致性|
|事务|高事务性|弱事务性|
|扩展性|一般|良好|
数据容量|优先数据|海量数据
标准化|是|否
技术支持|高|低
可维护性|复杂|复杂