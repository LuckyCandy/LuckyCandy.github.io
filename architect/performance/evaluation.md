## 性能评价

### 1. 性能评价指标
#### 1.1 名词解释
* **主频**: 即计算机<mark>内部时钟</mark>的频率，CPU的工作节拍就是由内部时钟不断产生固定频率的时钟脉冲决定，<mark>数值越高，CPU的运算速度越快</mark>，通常以MHz或者GHz为单位。

* **时钟周期**: 一个时钟脉冲所需要的时间，也称为震荡周期（晶振体原件以固定频率震荡产生脉冲），计算机中最小的时间单位，<mark>等于CPU主频的倒数</mark>。

* **机器周期**: 又称CPU周期。为了方便，常把一条指令的执行过程划分为若干个阶段（如取值、译码、执行等），每个阶段完成一个基本操作。完成一个基本操作的时间成为机器周期。一般情况下，一个机器周期由若干个时钟周期组成。

* **指令周期**: 取出并执行一条指令的时间。

* **CPI**: （Cycles Per Instruction）执行一条指令所需要的时钟周期。由于指令功能不同，因此每个指令的执行时间也不相同，所以CPI一般表达为一个均值。

* **IPC**: （Instructions Per Cycle）由于科技发展，指令执行的速度不断提高，常常一个时钟周期内可以执行多个指令。因此，CPI经常用IPC(一个时钟周期内可执行的指令数)表示，IPC也就是CPI的倒数。

* **MIPS**: （Million Instructions Per Second）每秒百万条指令的执行速度，其计算公式为：<br/><mark>MIPS = 指令数 / (执行时间 * 10^6) = 主频 / CPI = 主频 * IPC</mark>

#### 1.2 相关练习
1. 某台计算机的CPU主频是1.8GHz，<mark>若2个时钟周期组成1个机器周期，平均3个机器周期可完成一条指令</mark>，则改计算机的指令平均执行速度为 () MIPS?


[分析:]{color:red;font-weight:bold}
1. MIPS = 主频 / CPI，其中主频已经给出;
2. CPI是执行一条指令所需要的时钟周期，题中标注是解答点。

[解：]{color:red;font-weight:bold}

主频 * CPI = 主频 / (2(个时钟周期) * 3(个机器周期)) = 1.8GHz（1800MHz） / 6 = 300MIPS

### 2. 性能调整
#### 2.1 阿姆达尔定律

**阿姆达尔定律：**对系统中某个组件采用更快的执行方式，所获得的系统性能的改变程度取决于该组件的使用频率或者该组件运行时间占总执行时间的比例。

阿姆达尔定律定义了采用了更优组件所取得的加速比的计算公式：<br/>
<mark>加速比(R) = T<sub>p</sub> / T<sub>j</sub>，</mark><br/>其中 T<sub>p</sub> 代表原总执行时间，T<sub>j</sub> 改进组件后的总执行时间。

[例题：]{color:red;font-weight:bold}假设某一功能的处理时间为整个系统运行时间的60%，将此功能做了改进，时期速度提高了5倍。根据阿姆达尔定律，整个系统的处理速度可以提升至原来的()倍？

[分析:]{color:red;font-weight:bold}

提升至多少倍，实际是求加速比，只需要找到原来执行速度和提升后的执行速度，然后根据阿姆达尔公式解答即可。

[解:]{color:red;font-weight:bold}

设原执行速度为：T，那么原组件的执行速度为：60% * T，提高了5倍则为 12% * T，剩余组件速度不变为：40% * T，于是得：<br/>
R = T / (12% * T + 40% * T) ≈ 1.923

#### 2.2 数据库应用性能调优

造成性能不好的原因可能有数据库连接方式、系统应用架构、数据库设计、数据库管理、网络通信等，基于此可从以下方面着手：
* 修改应用模式，更加合理的使用数据库；
* 建立历史数据库，数据归档，减轻查询压力；
* 利用索引和分区技术
* 检查CPU和内存的使用状态，增加数据库连接池并设置合理的大小
* 监控系统状态，即使清理系统日志
* ...

#### 2.3 Web系统性能调优

可能的瓶颈有客户端程序、网络接口、数据库互连等，针对此可参考使用以下方案：
* 进行流量管控、负载均衡；
* 增加Web交换机；
* 使用Web缓存；
* 监控响应时间、用户数以及系统资源占用情况；
* ...

### 3. 性能评估方法

**真实程序测试**：直接使用完整的程序进行测试，对与系统的性能评估是准确度最高的一种方式。

**基准测试**：挑选应用中用的最多、最频繁的核心程序作为评估计算机系统性能的标准程序，称为基准测试程序(Benchmark)，主要有：核心程序、小型基准程序、合成基准程序等。该方法也是目前较好的测试系统性能的方法之一。
* 核心程序：最关键、最具代表性、最耗时的程序段集合
* 小型基准程序：一般在100行以内。
* 合成基准程序：人为合成的测试程序（需要先统计系统操作占比）